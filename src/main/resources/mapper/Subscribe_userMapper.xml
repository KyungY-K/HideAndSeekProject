<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="Subscribe_userDAO">
  
  	<insert id="subUser" parameterType="map">
  		insert into subscribe_user values(
  			#{pack},
  			sysdate,
  			'',
  			'구독',
  			#{userId},
  			#{pack_name},
  			#{deli_no}
  		)
  	</insert>
  	
  	<insert id="subStatus" parameterType="map">
  		insert into sub_user_status values(
  			(select nvl(max(sub_no), 0) from sub_user_status) +1,
  			'구독중',
  			#{userId}
  		)
  	</insert>
  	
  	<select id="sub_List" resultType="int" parameterType="String">
  		select count(*) from subscribe_user where user_id = #{userId}
  	</select>
  	
  	<select id="sub_user_list" resultType="Subscribe_userDTO" parameterType="String">
  		select su.sub_start, su.user_status, su.sub_package, d.deli_addr1, d.deli_addr2 
		from subscribe_user su join delivery d 
		on su.deli_no = d.deli_no 
		where su.user_id = #{userId} order by su.sub_start desc;
  	</select>
  
  </mapper>